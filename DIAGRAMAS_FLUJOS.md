# ğŸ”„ DIAGRAMAS DE FLUJO - HISTORIAS IMPLEMENTADAS

## HISTORIA 1: Registro de Usuario (US-01)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FLUJO: REGISTRO DE USUARIO                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            FRONTEND (Navegador)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  register.html                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Formulario:                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ [usuario]: texto                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ [correo]: texto (esperado @unal.edu.co)      â”‚  â”‚
â”‚  â”‚  â”œâ”€ [contrasena]: password                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ [confirmar]: password                         â”‚  â”‚
â”‚  â”‚  â””â”€ [Registrarse] â† CLICK                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ POST /register
                       â”‚ Form Data: {usuario, correo, contrasena, confirmar}
                       â†“
            BACKEND (app.py)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @app.route('/register', methods=['POST'])               â”‚
â”‚  def register():                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  VALIDACIONES:                                     â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  âœ“ if not usuario or not correo or not contrasena â”‚  â”‚
â”‚  â”‚    â†’ error: "Campos obligatorios"                  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  âœ“ if contrasena != confirmar                      â”‚  â”‚
â”‚  â”‚    â†’ error: "ContraseÃ±as no coinciden"             â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  âœ“ if not correo.endswith('@unal.edu.co')        â”‚  â”‚
â”‚  â”‚    â†’ error: "Solo emails @unal.edu.co"            â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  âœ“ if email_duplicado or usuario_duplicado        â”‚  â”‚
â”‚  â”‚    â†’ error: "Usuario/email ya existe"              â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  CREAR USUARIO:                                   â”‚  â”‚
â”‚  â”‚  nuevo_usuario = User(                             â”‚  â”‚
â”‚  â”‚    name=usuario,                                  â”‚  â”‚
â”‚  â”‚    email=correo,                                  â”‚  â”‚
â”‚  â”‚    password=contrasena,  âš ï¸ sin hash!            â”‚  â”‚
â”‚  â”‚    role_id=None                                   â”‚  â”‚
â”‚  â”‚  )                                                â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  GUARDAR EN BD:                                   â”‚  â”‚
â”‚  â”‚  db.session.add(nuevo_usuario)                    â”‚  â”‚
â”‚  â”‚  db.session.commit()                              â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  RESPUESTA:                                       â”‚  â”‚
â”‚  â”‚  redirect(url_for('login'))                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ INSERT INTO users
                       â”‚ (name, email, password, role_id)
                       â†“
            DATABASE (PostgreSQL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  users TABLE:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ user_id  â”‚ name     â”‚ email            â”‚ role_id  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1        â”‚ Juan     â”‚ juan@unal.edu.co â”‚ NULL     â”‚   â”‚
â”‚  â”‚ 2        â”‚ MarÃ­a    â”‚ maria@unal.edu.coâ”‚ NULL     â”‚   â”‚
â”‚  â”‚ 3        â”‚ Carlos â† â”‚ carlos@unal.edu.coâ”‚ NULL    â”‚   â”‚ â† NUEVO
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†‘
                       â”‚ Redirect
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  login.html                                               â”‚
â”‚  Mensaje: "Registro exitoso, inicia sesiÃ³n"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HISTORIA 2: AutenticaciÃ³n de Usuario (US-02)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO: AUTENTICACIÃ“N (LOGIN)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            FRONTEND
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  login.html                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Formulario:                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ [usuario]: carlos@unal.edu.co                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ [contrasena]: pass123                          â”‚  â”‚
â”‚  â”‚  â””â”€ [Iniciar sesiÃ³n] â† CLICK                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ POST /login
                           â”‚ {usuario, contrasena}
                           â†“
                        BACKEND
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app.py : login()                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PASO 1: VALIDAR CAMPOS                            â”‚  â”‚
â”‚  â”‚  if not usuario or not contrasena:                 â”‚  â”‚
â”‚  â”‚    return error âœ—                                  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  PASO 2: VALIDAR EMAIL INSTITUCIONAL               â”‚  â”‚
â”‚  â”‚  if not usuario.endswith('@unal.edu.co'):         â”‚  â”‚
â”‚  â”‚    return error âœ—                                  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  PASO 3: BUSCAR USUARIO EN BD                      â”‚  â”‚
â”‚  â”‚  user = User.query.filter_by(email=usuario).first()â”‚  â”‚
â”‚  â”‚  if user is None:                                  â”‚  â”‚
â”‚  â”‚    return error "Usuario/contraseÃ±a invÃ¡lidos" âœ—  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  PASO 4: VERIFICAR CONTRASEÃ‘A                      â”‚  â”‚
â”‚  â”‚  if user.password != contrasena:  âš ï¸ sin hash      â”‚  â”‚
â”‚  â”‚    return error "Usuario/contraseÃ±a invÃ¡lidos" âœ—  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  PASO 5: CREAR SESIÃ“N                              â”‚  â”‚
â”‚  â”‚  session['user_id'] = user.user_id                 â”‚  â”‚
â”‚  â”‚  session['usuario'] = user.name                    â”‚  â”‚
â”‚  â”‚  session['email'] = user.email                     â”‚  â”‚
â”‚  â”‚  session['role_name'] = 'estudiante' (por defecto) â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  PASO 6: REGISTRAR ACCESO EN BD                    â”‚  â”‚
â”‚  â”‚  acceso = AccessControl(                           â”‚  â”‚
â”‚  â”‚    user_id=user.user_id,                           â”‚  â”‚
â”‚  â”‚    token=uuid.uuid4(),                             â”‚  â”‚
â”‚  â”‚    login_time=NOW()                                â”‚  â”‚
â”‚  â”‚  )                                                 â”‚  â”‚
â”‚  â”‚  db.session.add(acceso)                            â”‚  â”‚
â”‚  â”‚  db.session.commit()                               â”‚  â”‚
â”‚  â”‚  session['access_id'] = acceso.access_id           â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  PASO 7: REDIRIGIR A MENÃš                          â”‚  â”‚
â”‚  â”‚  return redirect(url_for('menu'))                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
               â”‚                                         â”‚
               â”‚ INSERT INTO access_control               â”‚
               â†“                                         â”‚
            DATABASE                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  access_control TABLE:                   â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚             â”‚
â”‚  â”‚access_idâ”‚user_id â”‚login_timeâ”‚logout_tâ”‚â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚             â”‚
â”‚  â”‚42      â”‚3        â”‚2025-12-13â”‚ NULL   â”‚â”‚ â† NUEVO     â”‚
â”‚  â”‚        â”‚         â”‚14:30:00  â”‚        â”‚â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                                                        â”‚
SESSION (en memoria del servidor)                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ Flask Session:                      â”‚                â”‚
â”‚ â”œâ”€ user_id: 3                      â”‚                â”‚
â”‚ â”œâ”€ usuario: "Carlos"               â”‚                â”‚
â”‚ â”œâ”€ email: "carlos@unal.edu.co"    â”‚                â”‚
â”‚ â”œâ”€ role_name: "estudiante"        â”‚                â”‚
â”‚ â””â”€ access_id: 42                   â”‚ â† CREADA      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                                        â”‚
                                                        â”‚
RESPUESTA AL NAVEGADOR                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  HTTP 302 Redirect â†’ /menu                         â”‚ â”‚
â”‚  Set-Cookie: session=eyJ1c2VyX2lkIjozfQ...       â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                        â”‚
                                                        â†“
                                                FRONTEND
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚ menu.html      â”‚
                                            â”‚ âœ… Autenticado â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HISTORIA 3: Control de Acceso por Roles (US-03)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 FLUJO: CONTROL DE ACCESO POR ROLES                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    USUARIO INTENTA ACCEDER A RUTA

                            â†“ GET /horarios
                     (ruta protegida para admin)
                            â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @app.route('/horarios')                                 â”‚
â”‚  @require_roles(['admin', 'organizador'])  â† DECORADOR   â”‚
â”‚  def horarios():                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    EL DECORADOR SE EJECUTA PRIMERO
                            â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  def require_roles(allowed_roles):                       â”‚
â”‚    def decorator(fn):                                   â”‚
â”‚      @wraps(fn)                                         â”‚
â”‚      def wrapper(*args, **kwargs):                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚        â”‚  PASO 1: Leer sesiÃ³n                         â”‚ â”‚
â”‚        â”‚  user_id = session.get('user_id')            â”‚ â”‚
â”‚        â”‚  role_name = session.get('role_name')        â”‚ â”‚
â”‚        â”‚                                              â”‚ â”‚
â”‚        â”‚  PASO 2: Â¿Usuario autenticado?               â”‚ â”‚
â”‚        â”‚  if not user_id:                             â”‚ â”‚
â”‚        â”‚    return redirect('/login')  âœ—              â”‚ â”‚
â”‚        â”‚                                              â”‚ â”‚
â”‚        â”‚  PASO 3: Â¿Role autorizado?                   â”‚ â”‚
â”‚        â”‚  if role_name not in allowed_roles:          â”‚ â”‚
â”‚        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚        â”‚    â”‚ Casos posibles:              â”‚           â”‚ â”‚
â”‚        â”‚    â”‚                              â”‚           â”‚ â”‚
â”‚        â”‚    â”‚ Role='estudiante'            â”‚           â”‚ â”‚
â”‚        â”‚    â”‚ allowed=['admin','org']      â”‚           â”‚ â”‚
â”‚        â”‚    â”‚ â†’ 403 Forbidden âœ—            â”‚           â”‚ â”‚
â”‚        â”‚    â”‚                              â”‚           â”‚ â”‚
â”‚        â”‚    â”‚ Role='admin'                 â”‚           â”‚ â”‚
â”‚        â”‚    â”‚ allowed=['admin','org']      â”‚           â”‚ â”‚
â”‚        â”‚    â”‚ â†’ 200 Ejecutar funciÃ³n âœ“    â”‚           â”‚ â”‚
â”‚        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚        â”‚                                              â”‚ â”‚
â”‚        â”‚  PASO 4: Si OK â†’ ejecutar funciÃ³n            â”‚ â”‚
â”‚        â”‚  return fn(*args, **kwargs)                  â”‚ â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        CASOS PRÃCTICOS:

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ CASO 1: Estudiante intenta crear evento                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario (rol='estudiante')
    â”‚
    â””â”€â†’ POST /api/eventos/create
        â”‚
        â”œâ”€â†’ @require_roles(['admin', 'organizador'])
        â”‚
        â”œâ”€ 'estudiante' NOT IN ['admin', 'organizador']
        â”‚
        â””â”€â†’ RESPUESTA:
           403 Forbidden
           "No tienes permisos para acceder a esta funcionalidad"

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ CASO 2: Organizador intenta crear evento                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario (rol='organizador')
    â”‚
    â””â”€â†’ POST /api/eventos/create
        â”‚
        â”œâ”€â†’ @require_roles(['admin', 'organizador'])
        â”‚
        â”œâ”€ 'organizador' IN ['admin', 'organizador'] âœ“
        â”‚
        â”œâ”€â†’ Ejecuta funciÃ³n api_create_evento()
        â”‚
        â”œâ”€â†’ Valida datos
        â”‚
        â”œâ”€â†’ INSERT INTO event
        â”‚
        â””â”€â†’ RESPUESTA:
           201 Created
           {
             "id": 42,
             "titulo": "Taller Python",
             ...
           }

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ CASO 3: No autenticado intenta acceder                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Usuario sin sesiÃ³n
    â”‚
    â””â”€â†’ GET /horarios
        â”‚
        â”œâ”€â†’ @require_roles(['admin', 'organizador'])
        â”‚
        â”œâ”€ session.get('user_id') = None
        â”‚
        â””â”€â†’ RESPUESTA:
           redirect('/login')
           (Fuerza re-autenticaciÃ³n)

                    MATRIZ DE PERMISOS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ruta           â”‚Admin  â”‚Org    â”‚Estudiante  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚/horarios       â”‚ âœ…    â”‚ âœ…    â”‚ âŒ 403     â”‚
â”‚/eventos        â”‚ âœ…    â”‚ âœ…    â”‚ âœ…         â”‚
â”‚/crear evento   â”‚ âœ…    â”‚ âœ…    â”‚ âŒ 403     â”‚
â”‚/editar evento  â”‚ âœ…    â”‚ âœ…    â”‚ âŒ 403     â”‚
â”‚/inscritos      â”‚ âœ…    â”‚ âŒ    â”‚ âŒ 403     â”‚
â”‚/inscribirse    â”‚ âœ…    â”‚ âœ…    â”‚ âœ…         â”‚
â”‚/logout         â”‚ âœ…    â”‚ âœ…    â”‚ âœ…         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HISTORIA 4: CreaciÃ³n de Eventos (US-04)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FLUJO: CREACIÃ“N DE EVENTOS                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            FRONTEND (eventos.html)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                           â”‚
â”‚  [BotÃ³n] Crear Evento â† CLICK                            â”‚
â”‚                                                           â”‚
â”‚  â†“ Aparece Modal/Formulario                              â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Crear nuevo evento:                                â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ [Titulo*]        ____________________              â”‚  â”‚
â”‚  â”‚ [DescripciÃ³n]    ____________________              â”‚  â”‚
â”‚  â”‚ [Fecha*]         [2025-12-20]                      â”‚  â”‚
â”‚  â”‚ [Hora]           [14:30]                           â”‚  â”‚
â”‚  â”‚ [Lugar]          ____________________              â”‚  â”‚
â”‚  â”‚ [CategorÃ­a]      [dropdown]                        â”‚  â”‚
â”‚  â”‚ [Capacidad]      [100]                             â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ [Crear Evento]  â† CLICK                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
        JavaScript en frontend (eventos.html)
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ var formData = {             â”‚
                â”‚   titulo: "Taller Python...", â”‚
                â”‚   descripcion: "Aprende...",  â”‚
                â”‚   fecha: "2025-12-20",       â”‚
                â”‚   hora: "14:30",             â”‚
                â”‚   lugar: "Auditorio",        â”‚
                â”‚   categoria: "Tecnico",      â”‚
                â”‚   capacidad: 100             â”‚
                â”‚ }                            â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ fetch('/api/eventos/create', {
                               â”‚   method: 'POST',
                               â”‚   headers: {'Content-Type': 'application/json'},
                               â”‚   body: JSON.stringify(formData)
                               â”‚ })
                               â†“

                            BACKEND (app.py)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @app.route('/api/eventos/create', methods=['POST'])     â”‚
â”‚  @require_roles(['admin', 'organizador'])                â”‚
â”‚  def api_create_evento():                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PASO 1: Verificar autenticaciÃ³n                    â”‚  â”‚
â”‚  â”‚ user_id = session.get('user_id')                   â”‚  â”‚
â”‚  â”‚ if not user_id: return 401 âœ—                       â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 2: Leer datos JSON                            â”‚  â”‚
â”‚  â”‚ data = request.get_json()                          â”‚  â”‚
â”‚  â”‚ titulo = data.get('titulo')                        â”‚  â”‚
â”‚  â”‚ descripcion = data.get('descripcion')              â”‚  â”‚
â”‚  â”‚ fecha_str = data.get('fecha')                      â”‚  â”‚
â”‚  â”‚ hora_str = data.get('hora')                        â”‚  â”‚
â”‚  â”‚ lugar = data.get('lugar')                          â”‚  â”‚
â”‚  â”‚ categoria = data.get('categoria')                  â”‚  â”‚
â”‚  â”‚ capacidad = data.get('capacidad')                  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 3: VALIDAR CAMPOS REQUERIDOS                  â”‚  â”‚
â”‚  â”‚ if not titulo or not fecha_str:                    â”‚  â”‚
â”‚  â”‚   return 400 error "TÃ­tulo y fecha obligatorios"   â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 4: VALIDAR FORMATO FECHA                      â”‚  â”‚
â”‚  â”‚ try:                                               â”‚  â”‚
â”‚  â”‚   fecha = datetime.strptime(fecha_str, '%Y-%m-%d')â”‚  â”‚
â”‚  â”‚ except ValueError:                                 â”‚  â”‚
â”‚  â”‚   return 400 error "Formato YYYY-MM-DD"            â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 5: VALIDAR FORMATO HORA (si existe)           â”‚  â”‚
â”‚  â”‚ if hora_str:                                       â”‚  â”‚
â”‚  â”‚   try:                                             â”‚  â”‚
â”‚  â”‚     hora = datetime.strptime(hora_str, '%H:%M')   â”‚  â”‚
â”‚  â”‚   except ValueError:                               â”‚  â”‚
â”‚  â”‚     return 400 error "Formato HH:MM"               â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 6: VALIDAR CAPACIDAD (si existe)              â”‚  â”‚
â”‚  â”‚ if capacidad:                                      â”‚  â”‚
â”‚  â”‚   try:                                             â”‚  â”‚
â”‚  â”‚     capacidad = int(capacidad)                     â”‚  â”‚
â”‚  â”‚   except ValueError:                               â”‚  â”‚
â”‚  â”‚     return 400 error "Capacidad debe ser nÃºmero"   â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 7: CREAR OBJETO EVENTO                        â”‚  â”‚
â”‚  â”‚ nuevo_evento = Event(                              â”‚  â”‚
â”‚  â”‚   title=titulo,                                   â”‚  â”‚
â”‚  â”‚   description=descripcion,                         â”‚  â”‚
â”‚  â”‚   date=fecha,                                      â”‚  â”‚
â”‚  â”‚   time=hora,                                       â”‚  â”‚
â”‚  â”‚   location=lugar,                                  â”‚  â”‚
â”‚  â”‚   category=categoria,                              â”‚  â”‚
â”‚  â”‚   capacity=capacidad,                              â”‚  â”‚
â”‚  â”‚   status='activo'                                  â”‚  â”‚
â”‚  â”‚ )                                                  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 8: GUARDAR EN BD                              â”‚  â”‚
â”‚  â”‚ db.session.add(nuevo_evento)                       â”‚  â”‚
â”‚  â”‚ db.session.commit()                                â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 9: RETORNAR RESPUESTA                         â”‚  â”‚
â”‚  â”‚ return jsonify(nuevo_evento.to_dict()), 201        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    INSERT INTO event
                               â”‚
                               â†“

                            DATABASE (PostgreSQL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  event TABLE:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚event_idâ”‚title             â”‚date        â”‚capacity  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚1       â”‚Charla Agiles     â”‚2025-12-01  â”‚80        â”‚   â”‚
â”‚  â”‚2       â”‚Workshop Python   â”‚2025-12-05  â”‚120       â”‚   â”‚
â”‚  â”‚3       â”‚Hackathon UNAL    â”‚2025-12-10  â”‚50        â”‚   â”‚
â”‚  â”‚42 â†    â”‚Taller Python Avz â”‚2025-12-20  â”‚100       â”‚   â”‚ NUEVO
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    HTTP 201 Created
                               â”‚
                               â†“

                            FRONTEND
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response JSON:                                           â”‚
â”‚  {                                                        â”‚
â”‚    "id": 42,                                              â”‚
â”‚    "titulo": "Taller Python Avz",                         â”‚
â”‚    "fecha": "2025-12-20",                                 â”‚
â”‚    "capacidad": 100,                                      â”‚
â”‚    ...                                                    â”‚
â”‚  }                                                        â”‚
â”‚                                                           â”‚
â”‚  Frontend actualiza lista de eventos:                     â”‚
â”‚  [Nuevo evento aparece en grid]                           â”‚
â”‚                                                           â”‚
â”‚  Modal desaparece                                         â”‚
â”‚  âœ… "Evento creado exitosamente"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HISTORIA 8: InscripciÃ³n en Eventos (US-08)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 FLUJO: INSCRIPCIÃ“N EN EVENTO + QR                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        FASE 1: INSCRIPCIÃ“N
                        
                        FRONTEND (eventos.html)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lista de Eventos:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“Œ Taller Python Avanzado                         â”‚  â”‚
â”‚  â”‚     2025-12-20 Â· Auditorio Principal               â”‚  â”‚
â”‚  â”‚     [Inscribirse] â† CLICK                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“Œ Hackathon UNAL                                 â”‚  â”‚
â”‚  â”‚     2025-12-25 Â· Campus                            â”‚  â”‚
â”‚  â”‚     [Ya inscrito âœ“]                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                JavaScript: Click "Inscribirse"
                               â”‚
                    POST /api/eventos/42/registrar
                               â”‚
                               â†“

                            BACKEND (app.py)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @app.route('/api/eventos/<evento_id>/registrar',        â”‚
â”‚             methods=['POST'])                            â”‚
â”‚  def api_registrar_evento(evento_id):                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ VALIDACIONES:                                      â”‚  â”‚
â”‚  â”‚ âœ“ user_id = session.get('user_id')                â”‚  â”‚
â”‚  â”‚ âœ“ if not user_id: return 401                      â”‚  â”‚
â”‚  â”‚ âœ“ evento = Event.query.get(evento_id)             â”‚  â”‚
â”‚  â”‚ âœ“ if not evento: return 404                       â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ âœ“ ya_registrado = Registration.query.filter_by(  â”‚  â”‚
â”‚  â”‚     user_id=user_id,                              â”‚  â”‚
â”‚  â”‚     event_id=evento_id                            â”‚  â”‚
â”‚  â”‚   ).first()                                        â”‚  â”‚
â”‚  â”‚ âœ“ if ya_registrado:                               â”‚  â”‚
â”‚  â”‚     return error "Ya estÃ¡s registrado" 400        â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ CREAR REGISTRO:                                   â”‚  â”‚
â”‚  â”‚ registro = Registration(                           â”‚  â”‚
â”‚  â”‚   user_id=user_id,                                â”‚  â”‚
â”‚  â”‚   event_id=evento_id,                             â”‚  â”‚
â”‚  â”‚   status='inscrito',                              â”‚  â”‚
â”‚  â”‚   registration_date=NOW()                         â”‚  â”‚
â”‚  â”‚ )                                                  â”‚  â”‚
â”‚  â”‚ db.session.add(registro)                          â”‚  â”‚
â”‚  â”‚ db.session.commit()                               â”‚  â”‚
â”‚  â”‚ # Ahora tiene registration_id                     â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ GENERAR QR:                                       â”‚  â”‚
â”‚  â”‚ qr_data = "registro_id=142;user_id=1;event_id=42"â”‚  â”‚
â”‚  â”‚ img = qrcode.make(qr_data)                        â”‚  â”‚
â”‚  â”‚ buf = BytesIO()                                   â”‚  â”‚
â”‚  â”‚ img.save(buf, format="PNG")                       â”‚  â”‚
â”‚  â”‚ png_bytes = buf.getvalue()                        â”‚  â”‚
â”‚  â”‚ b64 = base64.b64encode(png_bytes).decode()        â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ GUARDAR QR EN BD:                                 â”‚  â”‚
â”‚  â”‚ registro.qr_code = b64                            â”‚  â”‚
â”‚  â”‚ db.session.commit()                               â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ RESPUESTA:                                        â”‚  â”‚
â”‚  â”‚ return jsonify({                                  â”‚  â”‚
â”‚  â”‚   "ok": true,                                     â”‚  â”‚
â”‚  â”‚   "evento_id": 42,                                â”‚  â”‚
â”‚  â”‚   "registration_id": 142,                         â”‚  â”‚
â”‚  â”‚   "qr_code": "iVBORw0KGgo..."                     â”‚  â”‚
â”‚  â”‚ }), 201                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    INSERT INTO registration
                               â”‚
                               â†“

                            DATABASE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  registration TABLE:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚reg_id    â”‚user_id  â”‚event_id  â”‚status    â”‚qr_code   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚142 â†     â”‚1        â”‚42        â”‚inscrito  â”‚iVBORw0K..â”‚  â”‚ NUEVO
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    HTTP 201 Created
                               â”‚
                               â†“

                        FASE 2: VER MIS EVENTOS CON QR

                        FRONTEND (mis_eventos.html)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Click "Mis Eventos" â†’ GET /api/mis-eventos              â”‚
â”‚                                                           â”‚
â”‚  RESPUESTA:                                               â”‚
â”‚  {                                                        â”‚
â”‚    "registration_id": 142,                                â”‚
â”‚    "titulo": "Taller Python Avanzado",                    â”‚
â”‚    "fecha": "2025-12-20",                                 â”‚
â”‚    "qr_code": "iVBORw0KGgo..." â† BASE64                   â”‚
â”‚  }                                                        â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Mis Eventos                                        â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ ğŸ“Œ Taller Python Avanzado                         â”‚  â”‚
â”‚  â”‚    2025-12-20 Â· Auditorio                         â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚  â”‚
â”‚  â”‚    â”‚      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚                            â”‚  â”‚
â”‚  â”‚    â”‚      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚ â† QR Code Image            â”‚  â”‚
â”‚  â”‚    â”‚      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚    (decoded from base64)   â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚    Estado: inscrito                               â”‚  â”‚
â”‚  â”‚    [Desuscribirse]                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        FASE 3: MOSTRAR QR PARA ESCANEAR

                Organizador: GET /registro/142/qr
                               â”‚
                               â†“
                
                app.py : qr_registro(142)
                â”œâ”€ Lee registro 142
                â”œâ”€ Lee evento 42
                â”œâ”€ Lee usuario 1
                â”œâ”€ Genera QR con texto:
                â”‚  "QUERCUS - Registro evento
                â”‚   Registro ID: 142
                â”‚   Evento: Taller Python Avanzado
                â”‚   Fecha: 2025-12-20 14:30
                â”‚   Usuario: Juan PÃ©rez
                â”‚   Correo: jperez@unal.edu.co"
                â””â”€ Retorna PNG image
                
                Browser muestra imagen PNG del QR
                â””â”€ Se puede escanear con celular
```

---

## HISTORIA 18: Logout Seguro (US-18)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 FLUJO: CIERRE DE SESIÃ“N SEGURO                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        USUARIO AUTENTICADO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  menu.html                                                â”‚
â”‚                                                           â”‚
â”‚  [Avatar Usuario] â† CLICK                                â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Juan PÃ©rez                                        â”‚  â”‚
â”‚  â”‚  jperez@unal.edu.co                                â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  [Editar Perfil]                                   â”‚  â”‚
â”‚  â”‚  [Cerrar SesiÃ³n] â† CLICK                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                   GET /logout â† Redirige a
                               â”‚
                               â†“

                            BACKEND (app.py)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  @app.route('/logout')                                   â”‚
â”‚  def logout():                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PASO 1: Leer datos de sesiÃ³n                       â”‚  â”‚
â”‚  â”‚ user_id = session.get('user_id')         # = 1    â”‚  â”‚
â”‚  â”‚ access_id = session.get('access_id')     # = 42   â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 2: Registrar logout_time en BD                â”‚  â”‚
â”‚  â”‚ if access_id:                                      â”‚  â”‚
â”‚  â”‚   entry = AccessControl.query.get(access_id)      â”‚  â”‚
â”‚  â”‚   if entry and entry.logout_time is None:         â”‚  â”‚
â”‚  â”‚     entry.logout_time = db.func.now()             â”‚  â”‚
â”‚  â”‚     db.session.commit()                            â”‚  â”‚
â”‚  â”‚     # INSERT timestamp de ahora                    â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 3: LIMPIAR SESIÃ“N                             â”‚  â”‚
â”‚  â”‚ session.clear()  â† Elimina:                        â”‚  â”‚
â”‚  â”‚   âœ— user_id                                        â”‚  â”‚
â”‚  â”‚   âœ— usuario                                        â”‚  â”‚
â”‚  â”‚   âœ— email                                          â”‚  â”‚
â”‚  â”‚   âœ— role_name                                      â”‚  â”‚
â”‚  â”‚   âœ— access_id                                      â”‚  â”‚
â”‚  â”‚   âœ— Toda la sesiÃ³n                                 â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚ PASO 4: Redirigir a login                          â”‚  â”‚
â”‚  â”‚ return redirect(url_for('login'))                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    UPDATE access_control
                    SET logout_time = NOW()
                    WHERE access_id = 42
                               â”‚
                               â†“

                            DATABASE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  access_control TABLE:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚access_idâ”‚user_id  â”‚login_time    â”‚logout_time       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚42      â”‚1        â”‚2025-12-13    â”‚2025-12-13        â”‚  â”‚
â”‚  â”‚        â”‚         â”‚14:30:00      â”‚15:45:22 â† NUEVO  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    HTTP 302 Redirect
                               â”‚
                               â†“

                            FRONTEND
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  login.html                                               â”‚
â”‚                                                           â”‚
â”‚  âœ… SesiÃ³n cerrada correctamente                         â”‚
â”‚                                                           â”‚
â”‚  Usuario debe re-autenticarse                            â”‚
â”‚                                                           â”‚
â”‚  Formulario de login listo                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         INTENTO DE ACCESO SIN SESIÃ“N (Seguridad)

Usuario intenta ir a /menu sin sesiÃ³n
           â”‚
           â””â”€â†’ GET /menu
               â”‚
               â”œâ”€â†’ user_id = session.get('user_id')  # None
               â”‚
               â”œâ”€ if not user_id:
               â”‚   return redirect(url_for('login'))
               â”‚
               â””â”€â†’ Redirige a login
                  (No puede acceder sin autenticarse)
```

---

## ğŸ“Š RESUMEN VISUAL DE 6 HUS IMPLEMENTADAS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HISTORIAS COMPLETADAS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

US-01 REGISTRO          US-02 AUTENTICACIÃ“N     US-03 ROLES
â”œâ”€ Input: Usuario       â”œâ”€ Input: Email/Pass    â”œâ”€ Admin
â”œâ”€ Email @unal          â”œâ”€ Valida en BD         â”œâ”€ Organizador
â”œâ”€ Password validado    â”œâ”€ Crea sesiÃ³n          â””â”€ Estudiante
â”œâ”€ Almacena en BD       â”œâ”€ Token Ãºnico          
â””â”€ Redirige a login     â””â”€ Redirige a menu      

        â†“                       â†“                      â†“
   users table          access_control table      @require_roles
   (4 campos)           (4 campos)                decorador

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

US-04 CREAR EVENTO      US-08 INSCRIBIR         US-09 QR + US-18 LOGOUT
â”œâ”€ Organiz. crea        â”œâ”€ Estudiante se        â”œâ”€ QR Ãºnico generado   â”œâ”€ Click logout
â”œâ”€ VÃ¡lida datos         â”‚   inscribe            â”œâ”€ Base64 en BD        â”œâ”€ Limpia sesiÃ³n
â”œâ”€ Almacena en BD       â”œâ”€ Crea registro        â”œâ”€ Imagen PNG para     â”œâ”€ logout_time en BD
â”œâ”€ Publicado            â”œâ”€ Asigna QR            â”‚   escanear           â””â”€ Redirige login
â””â”€ Visible en lista     â””â”€ Status: inscrito     â””â”€ Visible en mis_eventos

        â†“                       â†“                      â†“
   event table          registration table      (mismo registro)    access_control
  (11 campos)            (6 campos)                                  (actualiza)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ARQUITECTURA: Request/Response                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend (HTML/JS)
    â†“â†‘
  HTTP/HTTPS
    â†“â†‘
Flask Backend (app.py)
    â”œâ”€ @app.route decorators (20)
    â”œâ”€ Validaciones
    â”œâ”€ LÃ³gica de negocio
    â””â”€ Respuestas JSON/HTML
    â†“â†‘
SQLAlchemy ORM (models.py)
    â”œâ”€ User
    â”œâ”€ Event
    â”œâ”€ Registration
    â”œâ”€ AccessControl
    â”œâ”€ Role
    â”œâ”€ Payment (no usado)
    â”œâ”€ Notification (no usado)
    â””â”€ Report (no usado)
    â†“â†‘
PostgreSQL Database
    â””â”€ 8 tablas
```

